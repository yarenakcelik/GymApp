@{
    ViewData["Title"] = "Raporlar - Antrenörler";
}

<h2 class="mt-4 mb-3">Antrenör Raporu</h2>

<div class="row g-2 mb-3">
    <div class="col-md-4">
        <label class="form-label">Spor Salonu</label>
        <select id="gymSelect" class="form-select">
            <option value="">Hepsi</option>
        </select>
    </div>

    <div class="col-md-4">
        <label class="form-label">Uzmanlık</label>
        <select id="specSelect" class="form-select">
            <option value="">Hepsi</option>
        </select>
    </div>

    <div class="col-md-4 d-flex align-items-end">
        <button id="btnLoad" class="btn btn-primary w-100">Listele</button>
    </div>
</div>

<table class="table table-striped table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>Ad Soyad</th>
            <th>Spor Salonu</th>
            <th>Uzmanlık</th>
            <th>Müsaitlik</th>
        </tr>
    </thead>
    <tbody id="trainerTbody">
        <tr><td colspan="4">Yükleniyor...</td></tr>
    </tbody>
</table>

@section Scripts {
    <script>
        async function loadDropdowns() {
            // gyms
            const gymsRes = await fetch('/api/reports/gyms');
            const gyms = await gymsRes.json();
            const gymSelect = document.getElementById('gymSelect');
            gyms.forEach(g => {
                const opt = document.createElement('option');
                opt.value = g.id;
                opt.textContent = g.name;
                gymSelect.appendChild(opt);
            });

            // specializations
            const specRes = await fetch('/api/reports/specializations');
            const specs = await specRes.json();
            const specSelect = document.getElementById('specSelect');
            specs.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.id;
                opt.textContent = s.name;
                specSelect.appendChild(opt);
            });
        }

        async function loadTrainers() {
            const gymId = document.getElementById('gymSelect').value;
            const specId = document.getElementById('specSelect').value;

            let url = '/api/reports/trainers';
            const params = [];
            if (gymId) params.push(`gymId=${gymId}`);
            if (specId) params.push(`specializationId=${specId}`);
            if (params.length) url += '?' + params.join('&');

            const res = await fetch(url);
            const data = await res.json();

            const tbody = document.getElementById('trainerTbody');
            tbody.innerHTML = '';

            if (!data.length) {
                tbody.innerHTML = `<tr><td colspan="4">Kayıt bulunamadı.</td></tr>`;
                return;
            }

            data.forEach(t => {
                tbody.innerHTML += `
                    <tr>
                        <td>${t.fullName}</td>
                        <td>${t.gymName}</td>
                        <td>${t.specialization}</td>
                        <td>${t.availableFrom} - ${t.availableTo}</td>
                    </tr>
                `;
            });
        }

        document.getElementById('btnLoad').addEventListener('click', loadTrainers);

        // ilk açılışta
        (async () => {
            await loadDropdowns();
            await loadTrainers();
        })();
    </script>
}
